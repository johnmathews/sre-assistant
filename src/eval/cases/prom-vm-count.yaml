id: prom-vm-count
description: "Agent should count VMs using pve_guest_info metric"
question: "How many VMs are running in the Proxmox cluster?"

required_services: []

expected_tools:
  must_call: [prometheus_instant_query]
  may_call: []
  must_not_call: []

mocks:
  - url: "http://prometheus.test:9090/api/v1/query"
    method: GET
    status: 200
    body:
      status: "success"
      data:
        resultType: "vector"
        result:
          - metric: {}
            value: [1705312800, "12"]
  - url: "http://prometheus.test:9090/api/v1/metadata"
    method: GET
    status: 200
    body:
      status: "success"
      data:
        pve_guest_info:
          - type: "gauge"
            help: "Guest information"
            unit: ""

rubric: |
  The answer should:
  1. Report the number of VMs (12)
  2. Not fabricate claims about stopped or unavailable VMs â€” the data only provides a count of running guests
