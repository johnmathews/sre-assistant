id: memory-incident-search
description: "Agent should search incident memory when asked about past occurrences of an alert"
question: "Has the HighCPU alert on jellyfin happened before? What was the root cause?"

required_services: []

expected_tools:
  must_call: [memory_search_incidents]
  may_call: [grafana_get_alerts, memory_check_baseline]
  must_not_call: []

mocks:
  - url: "http://grafana.test:3000/api/alertmanager/grafana/api/v2/alerts/groups"
    method: GET
    status: 200
    body:
      - receiver:
          name: "default"
        alerts:
          - labels:
              alertname: "HighCPU"
              severity: "warning"
              hostname: "jellyfin"
            annotations:
              summary: "CPU usage above 90%"
            status:
              state: "active"
            startsAt: "2024-01-15T10:00:00Z"

memory_seed:
  incidents:
    - title: "HighCPU on jellyfin caused by 4K transcoding"
      description: "CPU spiked to 95% on jellyfin VM during 4K HEVC transcoding without hardware acceleration."
      alert_name: "HighCPU"
      root_cause: "Software transcoding of 4K HEVC content â€” hardware acceleration (Intel QuickSync) was disabled after a driver update."
      resolution: "Re-enabled Intel QuickSync for hardware transcoding in Jellyfin settings. CPU dropped to 15%."
      severity: "warning"
      services: "jellyfin"

rubric: |
  The answer should:
  1. Reference past incident data showing a previous HighCPU event on jellyfin
  2. Report that a past HighCPU incident on jellyfin was found
  3. Mention the root cause (4K transcoding / hardware acceleration) and resolution
