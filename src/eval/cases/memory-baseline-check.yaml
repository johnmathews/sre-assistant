id: memory-baseline-check
description: "Agent should check metric baselines when asked if a value is normal"
question: "Is 85% CPU usage on the media VM normal?"

required_services: []

expected_tools:
  must_call: [memory_check_baseline]
  may_call: [prometheus_instant_query, memory_search_incidents]
  must_not_call: []

mocks:
  - url: "http://prometheus.test:9090/api/v1/query"
    method: GET
    status: 200
    body:
      status: "success"
      data:
        resultType: "vector"
        result:
          - metric:
              hostname: "media"
            value: [1705312800, "0.85"]

memory_seed:
  baselines:
    - metric_name: "node_cpu_usage_ratio"
      labels: '{"hostname": "media"}'
      avg_value: 0.45
      p95_value: 0.78
      min_value: 0.12
      max_value: 0.82
      sample_count: 168
      window_days: 7
    - metric_name: "cpu_usage"
      labels: '{"hostname": "media"}'
      avg_value: 0.45
      p95_value: 0.78
      min_value: 0.12
      max_value: 0.82
      sample_count: 168
      window_days: 7
    - metric_name: "cpu_usage_ratio"
      labels: '{"hostname": "media"}'
      avg_value: 0.45
      p95_value: 0.78
      min_value: 0.12
      max_value: 0.82
      sample_count: 168
      window_days: 7

rubric: |
  The answer should:
  1. Compare the current 0.85 value against historical baseline data (avg, p95, min, max)
  2. Report whether the value is within normal range, above p95, etc.
  3. Provide context about what the baseline values are (e.g. average ~0.45, p95 ~0.78)
